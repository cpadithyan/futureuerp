<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future U - Growth & Management ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .sidebar-item.active { background-color: #3b82f6; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .status-badge-active { background-color: #dcfce7; color: #166534; }
        .status-badge-stopped { background-color: #fee2e2; color: #991b1b; }
        .status-badge-overdue { background-color: #fef2f2; color: #dc2626; border: 1px solid #fee2e2; }
        #loadingOverlay { transition: opacity 0.5s ease-out; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-[300] flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
        <p class="text-gray-500 font-medium">Connecting to Future U Cloud...</p>
    </div>

    <!-- PIN Lock Overlay -->
    <div id="pinOverlay" class="fixed inset-0 bg-slate-900/95 z-[250] hidden flex-col items-center justify-center p-6 backdrop-blur-md">
        <div class="w-full max-w-xs text-center">
            <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-2xl mb-6 mx-auto shadow-xl">
                <i class="fas fa-lock"></i>
            </div>
            <h3 class="text-white text-xl font-bold mb-2">Owner Access Required</h3>
            <p class="text-slate-400 text-sm mb-8">Please enter your 4-digit PIN to view sensitive financial data.</p>
            
            <div class="flex justify-center gap-3 mb-8">
                <div id="pin-1" class="w-4 h-4 rounded-full border-2 border-slate-600"></div>
                <div id="pin-2" class="w-4 h-4 rounded-full border-2 border-slate-600"></div>
                <div id="pin-3" class="w-4 h-4 rounded-full border-2 border-slate-600"></div>
                <div id="pin-4" class="w-4 h-4 rounded-full border-2 border-slate-600"></div>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <button onclick="pressPin('1')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">1</button>
                <button onclick="pressPin('2')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">2</button>
                <button onclick="pressPin('3')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">3</button>
                <button onclick="pressPin('4')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">4</button>
                <button onclick="pressPin('5')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">5</button>
                <button onclick="pressPin('6')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">6</button>
                <button onclick="pressPin('7')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">7</button>
                <button onclick="pressPin('8')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">8</button>
                <button onclick="pressPin('9')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">9</button>
                <button onclick="clearPin()" class="h-14 bg-red-900/30 text-red-500 rounded-xl text-sm font-bold hover:bg-red-900/50">CLR</button>
                <button onclick="pressPin('0')" class="h-14 bg-slate-800 text-white rounded-xl text-xl font-bold hover:bg-slate-700 active:scale-95 transition-all">0</button>
                <button onclick="cancelPin()" class="h-14 bg-slate-800 text-slate-400 rounded-xl text-sm font-bold hover:bg-slate-700">ESC</button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white shadow-xl transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
        <div class="p-6">
            <h1 class="text-2xl font-bold text-blue-600 flex items-center gap-2">
                <i class="fas fa-graduation-cap"></i> Future U
            </h1>
            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-widest font-bold">Cloud ERP Manager</p>
        </div>
        <nav class="mt-6 px-4 space-y-2">
            <button onclick="showTab('dashboard')" class="sidebar-item active w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-blue-50">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button onclick="showTab('students')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-blue-50">
                <i class="fas fa-users"></i> Student Database
            </button>
            <button onclick="showTab('fees')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-blue-50">
                <i class="fas fa-hand-holding-dollar"></i> Fee & Expenses
            </button>
            <button onclick="showTab('growth')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-blue-50">
                <i class="fas fa-bullseye"></i> Growth Scoreboard <i class="fas fa-lock ml-auto text-[10px] opacity-30"></i>
            </button>
            <button onclick="showTab('financials')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-blue-50">
                <i class="fas fa-building-columns"></i> Financial Plan <i class="fas fa-lock ml-auto text-[10px] opacity-30"></i>
            </button>
        </nav>
        <div class="absolute bottom-6 left-6 right-6">
            <div class="bg-blue-50 rounded-xl p-4">
                <p class="text-sm font-semibold text-blue-800">Growth Scoreboard</p>
                <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                    <div id="targetProgress" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
                <p id="targetText" class="text-xs mt-2 text-blue-600 font-medium">Syncing...</p>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 p-4 md:p-8">
        <header class="flex justify-between items-center mb-8">
            <button class="md:hidden text-2xl" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
            <h2 id="pageTitle" class="text-2xl font-bold text-gray-800">Dashboard</h2>
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p id="currentDate" class="text-sm text-gray-500 font-medium"></p>
                    <p id="cloudStatus" class="text-[10px] text-green-500 font-bold uppercase tracking-widest">‚óè Cloud Connected</p>
                </div>
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">FU</div>
            </div>
        </header>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active space-y-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="text-gray-500 font-medium mb-1 text-sm uppercase">Active Students</h3>
                    <p id="statActive" class="text-3xl font-bold">0</p>
                    <span id="targetSubtext" class="text-xs text-blue-500 font-semibold uppercase tracking-wider">Goal: 100</span>
                </div>
                <div class="glass-card p-6 rounded-2xl shadow-sm border-l-4 border-red-500">
                    <h3 class="text-gray-500 font-medium mb-1 text-sm uppercase">Overdue Fees</h3>
                    <p id="statOverdue" class="text-3xl font-bold text-red-600">0</p>
                    <span class="text-xs text-gray-400 font-semibold uppercase tracking-wider">Follow-up Priority</span>
                </div>
                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="text-gray-500 font-medium mb-1 text-sm uppercase">Monthly Profit</h3>
                    <p id="statProfit" class="text-3xl font-bold text-green-600">‚Çπ0</p>
                    <span class="text-xs text-green-500 font-semibold uppercase tracking-wider">Revenue - Expenses</span>
                </div>
                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="text-gray-500 font-medium mb-1 text-sm uppercase">Debt Repayment</h3>
                    <p id="statDebt" class="text-3xl font-bold text-red-400">‚Çπ0</p>
                    <span class="text-xs text-indigo-400 font-semibold uppercase tracking-wider">20% Logic</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h4 class="font-bold mb-4 flex items-center gap-2"><i class="fas fa-phone-alt text-blue-500"></i> Rural Follow-up List</h4>
                    <div id="followUpList" class="space-y-3">
                        <p class="text-sm text-gray-400 italic">Syncing active dues...</p>
                    </div>
                </div>
                <div class="bg-slate-900 p-8 rounded-2xl text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold mb-4">Strategic Allocation</h3>
                        <div id="miniAlloc" class="space-y-3"></div>
                    </div>
                    <div class="absolute -right-10 -bottom-10 opacity-10 text-8xl"><i class="fas fa-chart-pie"></i></div>
                </div>
            </div>
        </div>

        <!-- GROWTH SCOREBOARD TAB -->
        <div id="growth" class="tab-content space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Weekly Tracker Sheet -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h4 class="font-bold mb-4 flex items-center gap-2"><i class="fas fa-calendar-check text-blue-600"></i> Marketing Non-Negotiables</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-4">
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Daily Actions</p>
                                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-blue-50 transition-colors">
                                    <input type="checkbox" class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500" onchange="toggleTask('followup')">
                                    <span class="text-sm">5 Follow-up calls/day</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-blue-50 transition-colors">
                                    <input type="checkbox" class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500" onchange="toggleTask('whatsapp')">
                                    <span class="text-sm">WhatsApp Broadcast sent</span>
                                </label>
                            </div>
                            <div class="space-y-4">
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Weekly Actions</p>
                                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-blue-50 transition-colors">
                                    <input type="checkbox" class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500" onchange="toggleTask('social')">
                                    <span class="text-sm">3 Social Posts/week</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-blue-50 transition-colors">
                                    <input type="checkbox" class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500" onchange="toggleTask('improve')">
                                    <span class="text-sm">1 Operational Improvement</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h4 class="font-bold mb-4">Monthly Performance Targets</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-gray-400 uppercase text-[10px] tracking-widest font-bold">
                                        <th class="pb-4">Month</th>
                                        <th class="pb-4">Target Students</th>
                                        <th class="pb-4">Actual Students</th>
                                        <th class="pb-4">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="performanceBody">
                                    <!-- Targets vs Actuals -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Marketing Phase Card -->
                <div class="space-y-6">
                    <div class="bg-blue-600 text-white p-8 rounded-3xl shadow-xl">
                        <h3 id="currentPhaseTitle" class="text-xl font-bold mb-2">Phase 1: Foundation</h3>
                        <p id="currentPhaseDesc" class="text-sm opacity-80 mb-6">Focus on testimonials and local posters.</p>
                        <div class="space-y-4" id="phaseChecklist">
                            <!-- JS Driven -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STUDENTS TAB -->
        <div id="students" class="tab-content space-y-6">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold">Student Database</h3>
                <button onclick="openModal('studentModal')" class="bg-blue-600 text-white px-5 py-2 rounded-xl hover:bg-blue-700 font-semibold shadow-lg transition-all">
                    <i class="fas fa-user-plus mr-2"></i>New Admission
                </button>
            </div>
            <div class="glass-card rounded-2xl overflow-hidden shadow-sm border border-gray-100">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-4 font-semibold text-gray-600">Student</th>
                                <th class="p-4 font-semibold text-gray-600">Course</th>
                                <th class="p-4 font-semibold text-gray-600">Monthly Fee</th>
                                <th class="p-4 font-semibold text-gray-600">Next Due Date</th>
                                <th class="p-4 font-semibold text-gray-600">Status</th>
                                <th class="p-4 font-semibold text-gray-600">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- FEES & EXPENSES TAB -->
        <div id="fees" class="tab-content space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 space-y-6">
                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h4 class="font-bold mb-4 text-blue-600 flex items-center gap-2"><i class="fas fa-coins"></i> Collect Fee</h4>
                        <form id="feeForm" class="space-y-4">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Student</label>
                                <select id="feeStudentSelect" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-[10px] font-bold text-gray-400 uppercase">Amount (‚Çπ)</label>
                                    <input type="number" id="feeAmount" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required>
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-gray-400 uppercase">Type</label>
                                    <select id="feeType" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none">
                                        <option value="Monthly">Monthly Fee</option>
                                        <option value="Admission">Admission Fee</option>
                                        <option value="Advance">Bulk Advance</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Paid Date</label>
                                <input type="date" id="feeDate" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition-all">Record Payment</button>
                        </form>
                    </div>

                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-red-100">
                        <h4 class="font-bold mb-4 text-red-600 flex items-center gap-2"><i class="fas fa-shopping-cart"></i> Log Expense</h4>
                        <form id="expenseForm" class="space-y-4">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Expense Title</label>
                                <input type="text" id="expName" placeholder="e.g. Rent, Marketing Posters" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-[10px] font-bold text-gray-400 uppercase">Amount (‚Çπ)</label>
                                    <input type="number" id="expAmount" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required>
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-gray-400 uppercase">Date</label>
                                    <input type="date" id="expDate" class="w-full p-3 bg-gray-50 border rounded-xl mt-1 outline-none" required>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-red-500 text-white py-4 rounded-xl font-bold hover:bg-red-600 shadow-lg transition-all">Record Expense</button>
                        </form>
                    </div>
                </div>
                <div class="lg:col-span-2">
                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold">Transaction History</h4>
                            <div class="flex gap-2">
                                <span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded">Fees</span>
                                <span class="bg-red-100 text-red-700 text-[10px] font-bold px-2 py-1 rounded">Expenses</span>
                            </div>
                        </div>
                        <div id="transactionList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCIALS TAB -->
        <div id="financials" class="tab-content space-y-6">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass-card p-8 rounded-3xl shadow-sm" id="allocationStats"></div>
                <div class="flex flex-col gap-6">
                    <!-- Security Settings -->
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-blue-100">
                        <h4 class="font-bold text-lg mb-4 text-blue-600 flex items-center gap-2">
                            <i class="fas fa-key"></i> Security Settings
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Update Owner PIN</label>
                                <input type="password" id="newPin" maxlength="4" placeholder="Enter new 4-digit PIN" class="w-full p-4 border rounded-xl mt-1 outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button onclick="updatePin()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition-all">Update PIN</button>
                        </div>
                    </div>
                    
                    <div class="bg-slate-900 text-white p-8 rounded-3xl shadow-xl">
                        <h4 class="font-bold text-lg mb-4 text-blue-400">Hard Rules for 2026</h4>
                        <div class="space-y-4 text-sm opacity-90">
                            <p class="flex items-start gap-3"><i class="fas fa-exclamation-triangle mt-1 text-yellow-400"></i> Rewards ONLY from Personal % bucket.</p>
                            <p class="flex items-start gap-3"><i class="fas fa-exclamation-triangle mt-1 text-yellow-400"></i> If profit < target, Personal bucket = 0%.</p>
                            <p class="flex items-start gap-3"><i class="fas fa-lock mt-1 text-red-400"></i> Jan-Mar: Heavy debt repayment, minimal personal spending.</p>
                        </div>
                    </div>
                    <div class="glass-card p-8 rounded-3xl shadow-sm text-center">
                        <h4 class="font-bold mb-4">Backup & Maintenance</h4>
                        <button onclick="exportBackup()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-4 rounded-2xl flex items-center justify-center gap-2 transition-all">
                            <i class="fas fa-download"></i> Download Data Backup
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Admission Modal -->
    <div id="studentModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-[100] p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-3xl p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">New Enrollment</h3>
                <button onclick="closeModal('studentModal')" class="text-gray-400 hover:text-black text-3xl">&times;</button>
            </div>
            <form id="enrollmentForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Student Name</label>
                    <input type="text" id="stuName" class="w-full p-4 border rounded-xl outline-none mt-1" required>
                </div>
                <div class="md:col-span-2">
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Select Course</label>
                    <select id="stuCourse" class="w-full p-4 border rounded-xl outline-none mt-1" required></select>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Adm. Fee (‚Çπ)</label>
                    <input type="number" id="stuAdmFee" value="500" class="w-full p-4 border rounded-xl mt-1 outline-none" required>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Monthly Fee (‚Çπ)</label>
                    <input type="number" id="stuMlyFee" value="1000" class="w-full p-4 border rounded-xl mt-1 outline-none" required>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Joining Date</label>
                    <input type="date" id="stuDate" class="w-full p-4 border rounded-xl mt-1 outline-none" required>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">First Due Date</label>
                    <input type="date" id="stuDueDate" class="w-full p-4 border rounded-xl mt-1 outline-none" required>
                </div>
                <div class="md:col-span-2 pt-4">
                    <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700 shadow-xl transition-all">Enroll & Sync to Cloud</button>
                </div>
            </form>
        </div>
    </div>

    <div id="notif" class="fixed bottom-6 right-6 hidden bg-gray-900 text-white px-8 py-4 rounded-2xl shadow-2xl z-[200]">Action Successful!</div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, getDoc, collection, onSnapshot, query, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2bcDcHkL7mtu8Hy_XsrrCnJ1TRfzJNyc",
            authDomain: "futureuerp.firebaseapp.com",
            projectId: "futureuerp",
            storageBucket: "futureuerp.firebasestorage.app",
            messagingSenderId: "199842262718",
            appId: "1:199842262718:web:553ca10bb5da77656478ef",
            measurementId: "G-WHXM1VDGZY"
        };

        const COURSE_LIST = ["DIFA‚Äì Diploma in Indian and Foreign Accounting", "PDIFA‚Äì Professional Diploma in Indian & Foreign Accounting", "DFA‚Äì Diploma in Financial Accounting", "PGDCA‚Äì Post Graduate Diploma in Computer Application", "DCA‚ÄìDiploma in Computer Application", "DOM‚ÄìDiploma in Office Management", "Graphic Designing + Digital Marketing", "NIOS", "Vacation Course", "JAVA Programming", "PYTHON Programming", "HTML", "Zoho Books", "Tally Prime", "Adobe Photoshop", "Adobe PageMaker", "Adobe InDesign", "Microsoft Excel", "Microsoft Office Suite", "PSC Coaching", "SSC Coaching", "RRB Coaching", "SSC + RRB Coaching", "Reading Room / Study Centre Access"];

        const TARGETS = [
            { m: "Jan", t: 25 }, { m: "Feb", t: 40 }, { m: "Mar", t: 60 }, { m: "Apr", t: 80 }, { m: "May", t: 100 }
        ];

        const PHASES = [
            { id: 1, title: "Foundation (Jan-Feb)", desc: "Collect testimonials and run demo classes.", checklist: ["WhatsApp Broadcast List", "Collect 5 Testimonials", "Free Demo Classes", "Poster Campaign"] },
            { id: 2, title: "Scale (Mar-Apr)", desc: "Daily shorts and referral program.", checklist: ["Daily YouTube Shorts", "Referral Program", "School Outreach", "Google My Business"] },
            { id: 3, title: "Authority (May-Jun)", desc: "Paid ads and weekly webinars.", checklist: ["Paid Ads (Small)", "Weekly Webinars", "Newspaper Ads", "Content Pillars"] }
        ];

        // State
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'futureuerp';
        
        let appState = {
            students: [],
            transactions: [],
            expenses: [],
            user: null,
            adminPin: '4568',
            isAuthenticated: false,
            currentInputPin: '',
            targetTab: 'dashboard'
        };

        // UI Helpers
        const safeSetText = (id, text) => {
            const el = document.getElementById(id);
            if (el) el.innerText = text;
        };

        const safeSetHTML = (id, html) => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = html;
        };

        const showNotif = (msg) => {
            const n = document.getElementById('notif');
            if (n) {
                n.innerText = msg;
                n.classList.remove('hidden');
                setTimeout(() => n.classList.add('hidden'), 3000);
            }
        };

        const closeModal = (id) => {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        };
        window.closeModal = closeModal;

        const showTab = (tabId) => {
            if((tabId === 'growth' || tabId === 'financials') && !appState.isAuthenticated) {
                appState.targetTab = tabId;
                const overlay = document.getElementById('pinOverlay');
                if (overlay) overlay.classList.remove('hidden');
                return;
            }

            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            const targetEl = document.getElementById(tabId);
            if (targetEl) targetEl.classList.add('active');
            
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.toggle('active', el.getAttribute('onclick').includes(tabId)));
            
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                pageTitle.innerText = tabId === 'growth' ? "Growth Scoreboard" : (tabId === 'financials' ? "Financial Plan" : tabId.charAt(0).toUpperCase() + tabId.slice(1));
            }
            updateUI();
        };
        window.showTab = showTab;

        window.toggleSidebar = () => {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.classList.toggle('-translate-x-full');
        };

        // PIN Logic
        window.pressPin = (num) => {
            if(appState.currentInputPin.length < 4) {
                appState.currentInputPin += num;
                updatePinVisuals();
                if(appState.currentInputPin.length === 4) {
                    validatePin();
                }
            }
        };

        window.clearPin = () => {
            appState.currentInputPin = '';
            updatePinVisuals();
        };

        window.cancelPin = () => {
            clearPin();
            const overlay = document.getElementById('pinOverlay');
            if (overlay) overlay.classList.add('hidden');
        };

        const updatePinVisuals = () => {
            for(let i = 1; i <= 4; i++) {
                const dot = document.getElementById(`pin-${i}`);
                if(dot) {
                    if(appState.currentInputPin.length >= i) {
                        dot.classList.add('bg-blue-500', 'border-blue-500');
                    } else {
                        dot.classList.remove('bg-blue-500', 'border-blue-500');
                    }
                }
            }
        };

        const validatePin = () => {
            if(appState.currentInputPin === appState.adminPin) {
                appState.isAuthenticated = true;
                showNotif("Access Granted");
                const overlay = document.getElementById('pinOverlay');
                if (overlay) overlay.classList.add('hidden');
                showTab(appState.targetTab);
                clearPin();
            } else {
                showNotif("Incorrect PIN");
                clearPin();
            }
        };

        window.updatePin = async () => {
            const input = document.getElementById('newPin');
            const newPin = input ? input.value : '';
            if(newPin.length !== 4 || isNaN(newPin)) {
                showNotif("PIN must be 4 digits");
                return;
            }
            try {
                const pinRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'admin');
                await setDoc(pinRef, { pin: newPin }, { merge: true });
                showNotif("PIN Updated Successfully");
                if (input) input.value = '';
            } catch (err) {
                showNotif("Error updating PIN");
            }
        };

        // Init App
        const init = async () => {
            await signInAnonymously(auth);
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    appState.user = user;
                    const overlay = document.getElementById('loadingOverlay');
                    if (overlay) {
                        overlay.style.opacity = '0';
                        setTimeout(() => overlay.style.display = 'none', 500);
                    }
                    startSync();
                }
            });

            const today = new Date().toISOString().split('T')[0];
            safeSetText('currentDate', new Date().toLocaleDateString('en-IN', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }));
            
            const stuDateInput = document.getElementById('stuDate');
            if (stuDateInput) stuDateInput.value = today;
            const feeDateInput = document.getElementById('feeDate');
            if (feeDateInput) feeDateInput.value = today;
            const expDateInput = document.getElementById('expDate');
            if (expDateInput) expDateInput.value = today;
            
            const nextMonth = new Date(); nextMonth.setDate(nextMonth.getDate() + 30);
            const stuDueDateInput = document.getElementById('stuDueDate');
            if (stuDueDateInput) stuDueDateInput.value = nextMonth.toISOString().split('T')[0];
            
            safeSetHTML('stuCourse', COURSE_LIST.map(c => `<option value="${c}">${c}</option>`).join(''));
            
            // Set Phase Info
            const currentMonthIdx = new Date().getMonth();
            let activePhase = PHASES[0];
            if(currentMonthIdx >= 2 && currentMonthIdx <= 3) activePhase = PHASES[1];
            if(currentMonthIdx >= 4) activePhase = PHASES[2];
            
            safeSetText('currentPhaseTitle', activePhase.title);
            safeSetText('currentPhaseDesc', activePhase.desc);
            safeSetHTML('phaseChecklist', activePhase.checklist.map(item => `
                <div class="flex items-center gap-3">
                    <div class="w-5 h-5 border-2 border-white/40 rounded flex items-center justify-center text-[10px]"><i class="fas fa-check"></i></div>
                    <span class="text-xs font-medium">${item}</span>
                </div>
            `).join(''));
        };

        const startSync = () => {
            if (!appState.user) return;

            // Sync PIN
            const pinRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'admin');
            onSnapshot(pinRef, (snap) => {
                if(snap.exists()) {
                    appState.adminPin = snap.data().pin;
                } else {
                    setDoc(pinRef, { pin: '4568' });
                }
            }, (err) => console.error("PIN sync error:", err));

            const sRef = collection(db, 'artifacts', appId, 'public', 'data', 'students');
            onSnapshot(sRef, (snap) => { 
                appState.students = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                updateUI(); 
            }, (err) => console.error("Students sync error:", err));
            
            const tRef = collection(db, 'artifacts', appId, 'public', 'data', 'transactions');
            onSnapshot(tRef, (snap) => { 
                appState.transactions = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                updateUI(); 
            }, (err) => console.error("Transactions sync error:", err));

            const eRef = collection(db, 'artifacts', appId, 'public', 'data', 'expenses');
            onSnapshot(eRef, (snap) => { 
                appState.expenses = snap.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                updateUI(); 
            }, (err) => console.error("Expenses sync error:", err));
        };

        const updateUI = () => {
            const today = new Date();
            const activeStudents = appState.students.filter(s => s.status === 'Active');
            const overdue = activeStudents.filter(s => new Date(s.nextDueDate) < today);

            safeSetText('statActive', activeStudents.length);
            safeSetText('statOverdue', overdue.length);
            
            const totalRev = appState.transactions.reduce((a, b) => a + (Number(b.amount) || 0), 0);
            const totalExp = appState.expenses.reduce((a, b) => a + (Number(b.amount) || 0), 0);
            const profit = totalRev - totalExp;

            safeSetText('statProfit', `‚Çπ${profit.toLocaleString()}`);
            safeSetText('statRevenue', `‚Çπ${totalRev.toLocaleString()}`);
            safeSetText('statDebt', `‚Çπ${(totalRev * 0.2).toLocaleString()}`);

            const prog = (activeStudents.length / 100) * 100;
            const progressEl = document.getElementById('targetProgress');
            if (progressEl) progressEl.style.width = Math.min(prog, 100) + '%';
            safeSetText('targetText', `${activeStudents.length} / 100 Students`);

            // Performance Body
            const currentMonthName = today.toLocaleDateString('en-US', { month: 'short' });
            safeSetHTML('performanceBody', TARGETS.map(target => {
                const isCurrent = target.m === currentMonthName;
                const status = activeStudents.length >= target.t ? '‚úÖ Met' : 'üìà Progress';
                return `
                    <tr class="border-b border-gray-50 ${isCurrent ? 'bg-blue-50/50' : ''}">
                        <td class="py-3 font-bold">${target.m}</td>
                        <td class="py-3 text-gray-500">${target.t} Students</td>
                        <td class="py-3 font-bold">${activeStudents.length} Students</td>
                        <td class="py-3"><span class="px-2 py-1 rounded-full text-[10px] font-bold ${activeStudents.length >= target.t ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">${status}</span></td>
                    </tr>
                `;
            }).join(''));

            // Transactions & Expenses combined history
            const allHistory = [
                ...appState.transactions.map(t => ({ ...t, kind: 'fee' })),
                ...appState.expenses.map(e => ({ ...e, kind: 'exp', paidDate: e.date, studentName: e.name }))
            ].sort((a,b) => new Date(b.paidDate) - new Date(a.paidDate));

            safeSetHTML('transactionList', allHistory.slice(0, 30).map(item => `
                <div class="flex justify-between items-center p-4 rounded-2xl border ${item.kind === 'fee' ? 'bg-green-50/50 border-green-100' : 'bg-red-50/50 border-red-100'}">
                    <div>
                        <p class="font-bold text-gray-800 text-sm">${item.studentName}</p>
                        <p class="text-[9px] text-gray-400 font-bold uppercase">${item.paidDate} ‚Ä¢ ${item.kind === 'fee' ? 'FEE COLLECTION' : 'EXPENSE'}</p>
                    </div>
                    <p class="font-bold text-sm ${item.kind === 'fee' ? 'text-green-600' : 'text-red-600'}">${item.kind === 'fee' ? '+' : '-'}‚Çπ${item.amount}</p>
                </div>
            `).join(''));

            // Follow-ups
            const followUps = overdue.sort((a,b) => new Date(a.nextDueDate) - new Date(b.nextDueDate));
            safeSetHTML('followUpList', followUps.length ? followUps.slice(0, 5).map(s => `
                <div class="flex justify-between items-center p-3 bg-red-50 border border-red-100 rounded-xl">
                    <span class="text-xs font-bold text-red-700">${s.name}</span>
                    <span class="text-[10px] font-bold bg-white px-2 py-1 rounded-md text-red-500">Due: ${s.nextDueDate}</span>
                </div>
            `).join('') : '<p class="text-sm text-gray-400 italic">Everyone is up to date!</p>');

            // Table
            safeSetHTML('studentTableBody', appState.students.map(s => {
                const isOverdue = new Date(s.nextDueDate) < today && s.status === 'Active';
                return `
                    <tr class="border-b hover:bg-gray-50 text-sm">
                        <td class="p-4"><p class="font-bold text-gray-800">${s.name}</p></td>
                        <td class="p-4 text-xs max-w-[120px] truncate">${s.course}</td>
                        <td class="p-4 font-semibold text-blue-600">‚Çπ${s.mlyFee}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded-lg font-bold text-[10px] ${isOverdue ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">${s.nextDueDate}</span></td>
                        <td class="p-4"><span class="px-2 py-1 rounded-full text-[10px] font-bold ${s.status === 'Active' ? 'status-badge-active' : 'status-badge-stopped'}">${s.status}</span></td>
                        <td class="p-4 flex gap-3">
                            <button onclick="window.updateStatus('${s.id}', '${s.status === 'Active' ? 'Stopped' : 'Active'}')" class="text-gray-400 hover:text-blue-600"><i class="fas ${s.status === 'Active' ? 'fa-stop-circle' : 'fa-play-circle'}"></i></button>
                            <button onclick="window.deleteStudent('${s.id}')" class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join(''));

            safeSetHTML('feeStudentSelect', '<option value="">Select Student...</option>' + 
                activeStudents.map(s => `<option value="${s.id}">${s.name}</option>`).join(''));

            // Allocation
            const al = [{ n: 'Essentials', v: 0.35, c: 'blue' }, { n: 'Reinvestment', v: 0.20, c: 'indigo' }, { n: 'Debt', v: 0.20, c: 'red' }, { n: 'Savings', v: 0.15, c: 'green' }, { n: 'Personal', v: 0.10, c: 'yellow' }];
            safeSetHTML('allocationStats', `<h4 class="font-bold mb-6 text-xl">Allocation Logic</h4>` + al.map(cat => `
                <div class="mb-5">
                    <div class="flex justify-between text-xs font-bold mb-1"><span>${cat.n} (${cat.v*100}%)</span><span>‚Çπ${Math.floor(totalRev*cat.v).toLocaleString()}</span></div>
                    <div class="w-full bg-gray-100 h-1.5 rounded-full"><div class="bg-${cat.c}-500 h-1.5 rounded-full" style="width:${cat.v*100}%"></div></div>
                </div>
            `).join(''));

            safeSetHTML('miniAlloc', al.slice(0, 3).map(cat => `
                <div class="flex justify-between text-xs font-medium opacity-80"><span>${cat.n}</span><span>‚Çπ${Math.floor(totalRev*cat.v).toLocaleString()}</span></div>
            `).join(''));
        };

        // Actions
        document.getElementById('enrollmentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const student = { name: document.getElementById('stuName').value, course: document.getElementById('stuCourse').value, admFee: Number(document.getElementById('stuAdmFee').value), mlyFee: Number(document.getElementById('stuMlyFee').value), date: document.getElementById('stuDate').value, nextDueDate: document.getElementById('stuDueDate').value, status: 'Active', totalPaid: 0, createdAt: new Date().toISOString() };
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'students'), student);
            showNotif('Student enrolled!'); closeModal('studentModal'); e.target.reset();
        });

        document.getElementById('feeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const sId = document.getElementById('feeStudentSelect').value;
            const student = appState.students.find(s => s.id == sId);
            const paidDate = document.getElementById('feeDate').value;
            const nextDueObj = new Date(paidDate); nextDueObj.setDate(nextDueObj.getDate() + 30);
            
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'), { studentId: sId, studentName: student.name, amount: Number(document.getElementById('feeAmount').value), type: document.getElementById('feeType').value, paidDate, cycleDueDate: student.nextDueDate });
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', sId), { nextDueDate: nextDueObj.toISOString().split('T')[0], totalPaid: (student.totalPaid || 0) + Number(document.getElementById('feeAmount').value) });
            showNotif('Payment Recorded!'); e.target.reset();
        });

        document.getElementById('expenseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), { name: document.getElementById('expName').value, amount: Number(document.getElementById('expAmount').value), date: document.getElementById('expDate').value });
            showNotif('Expense Recorded!'); e.target.reset();
        });

        window.updateStatus = async (id, status) => { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', id), { status }); showNotif('Status updated'); };
        window.deleteStudent = async (id) => { if (confirm("Delete student?")) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', id)); };
        window.openModal = (id) => {
            const el = document.getElementById(id);
            if (el) el.style.display = 'flex';
        }
        window.exportBackup = () => {
            const data = { students: appState.students, transactions: appState.transactions, expenses: appState.expenses, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a"); a.href = url; a.download = `FutureU_Backup_${new Date().toISOString().split('T')[0]}.json`; a.click();
        };

        window.toggleTask = (type) => {
            showNotif(`${type.toUpperCase()} recorded for today.`);
        };

        init();
    </script>
</body>
</html>
